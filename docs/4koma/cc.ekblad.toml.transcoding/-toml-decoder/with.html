<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>with</title>
<link href="../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../../";</script>    <script>const storage = localStorage.getItem("dokka-dark-mode")
const savedDarkMode = storage ? JSON.parse(storage) : false
if(savedDarkMode === true){
    document.getElementsByTagName("html")[0].classList.add("theme-dark")
}</script>
<script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async="async"></script><link href="../../../styles/style.css" rel="Stylesheet"><link href="../../../styles/jetbrains-mono.css" rel="Stylesheet"><link href="../../../styles/main.css" rel="Stylesheet"><link href="../../../styles/prism.css" rel="Stylesheet"><link href="../../../styles/logo-styles.css" rel="Stylesheet"><script type="text/javascript" src="../../../scripts/clipboard.js" async="async"></script><script type="text/javascript" src="../../../scripts/navigation-loader.js" async="async"></script><script type="text/javascript" src="../../../scripts/platform-content-handler.js" async="async"></script><script type="text/javascript" src="../../../scripts/main.js" async="async"></script><script type="text/javascript" src="../../../scripts/prism.js" async="async"></script>  </head>
  <body>
    <div class="navigation-wrapper" id="navigation-wrapper">
      <div id="leftToggler"><span class="icon-toggler"></span></div>
      <div class="library-name"><a href="../../../index.html">4koma</a></div>
      <div>0.4.0</div>
      <div class="pull-right d-flex"><button id="theme-toggle-button"><span id="theme-toggle"></span></button>
        <div id="searchBar"></div>
      </div>
    </div>
    <div id="container">
      <div id="leftColumn">
        <div id="sideMenu"></div>
      </div>
      <div id="main"><script type="text/javascript" src="../../../scripts/main.js"></script>
        <div class="main-content" id="content" pageIds="4koma::cc.ekblad.toml.transcoding/TomlDecoder/with/#kotlin.Array[kotlin.Pair[kotlin.reflect.KClass[*],kotlin.Function3[cc.ekblad.toml.transcoding.TomlDecoder,kotlin.reflect.KType,cc.ekblad.toml.TomlValue,kotlin.Any?]]]/PointingToDeclaration//769193423">
          <div class="breadcrumbs"><a href="../../../index.html">4koma</a>/<a href="../index.html">cc.ekblad.toml.transcoding</a>/<a href="index.html">TomlDecoder</a>/<a href="with.html">with</a></div>
          <div class="cover ">
            <h1 class="cover"><span><span>with</span></span></h1>
          </div>
          <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/main"><div class="symbol monospace"><span class="token keyword"></span><span class="token keyword">fun </span><a href="with.html"><span class="token function">with</span></a><span class="token punctuation">(</span><span class="token keyword">vararg </span>decoderFunctions<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-pair/index.html">Pair</a><span class="token operator">&lt;</span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-class/index.html">KClass</a><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">, </span><span class="token keyword"></span><span class="token keyword"></span><a href="index.html">TomlDecoder</a><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword"></span>targetType<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-type/index.html">KType</a><span class="token punctuation">, </span><span class="token keyword"></span>tomlValue<span class="token operator">: </span><a href="../../cc.ekblad.toml/-toml-value/index.html">TomlValue</a><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-any/index.html">Any</a><span class="token operator">?</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">: </span><a href="index.html">TomlDecoder</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Returns a copy of the target TOML decoder, extended with zero or more additional custom decoder functions. A custom decoder function is a function from a <a href="../../cc.ekblad.toml/-toml-value/index.html">TomlValue</a> and a <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-type/index.html">KType</a> representing a target type, to that target type. Custom decoder functions are associated with a <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-class/index.html">KClass</a> representing that target type.</p><p class="paragraph">When a TOML value is decoded to some target type, the decoder will look for all decoder functions associated with that type. All decoder functions matching that type are then tried in the order they were registered with the decoder, from newest to oldest. I.e. for some decoder <code class="lang-kotlin">D = TomlDecoder.default.with(T to A).with(T to B)</code>, <code class="lang-kotlin">B</code> will always be tried before <code class="lang-kotlin">A</code> when trying to decode values of type <code class="lang-kotlin">T</code>.</p><p class="paragraph">A decoder function can signal that they are unable to decode their given input by calling <a href="pass.html">pass</a>. When this happens, the decoder will go on to try the next relevant decoder, if any.</p><p class="paragraph">As an example, to decode a TOML document allowing integers to be decoded into Kotlin strings:</p><br><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val myDecoder = TomlDecoder.default.with(<br>    String::class to { _, tomlValue -&gt;<br>        (tomlValue as? TomlValue.Integer)?.let { tomlValue.value.toString() } ?: pass()<br>    }<br>)<br>val result = TomlValue.from(Path.of(&quot;path&quot;, &quot;to&quot;, &quot;file.toml&quot;)).decode(myDecoder)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><br><p class="paragraph">Binding decoder functions to a KClass rather than a KType, while allowing the decoder function to access that KType, allows for more fine-grained control over deserialization. Let's say, for instance, that you have a custom data structure, generic in its elements, that you want to decode TOML values into.</p><p class="paragraph">If a decoder function was bound to a KType, you would need to register one decoder function for MyDataStructure<Int>, one for MyDataStructure<String>, etc. - a lot of unnecessary boilerplate.</p><p class="paragraph">If a decoder function was bound to a KClass and did not have access to the corresponding KType, you would have no way of knowing the type of the elements of the data structure. You would instead be forced to rely on the default decoding of TOML values - <a href="../../cc.ekblad.toml/-toml-value/-integer/index.html">TomlValue.Integer</a> into <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html">Long</a>, <a href="../../cc.ekblad.toml/-toml-value/-map/index.html">TomlValue.Map</a> into <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-map/index.html">Map</a>, and so on - an unacceptable loss of functionality.</p><p class="paragraph">A decoder function with access to the target type's KType, bound to the target type's KClass gets the best of both worlds. As an example, here is how you would create a custom decoder function for the generic data structure used in the above paragraphs.</p><br><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val myDecoder = TomlDecoder.default.with(<br>    MyDataStructure::class to { kType, tomlValue -&gt;<br>        (tomlValue as? TomlValue.List)?.let {<br>            val myDataStructure = MyDataStructure&lt;Any&gt;()<br>            tomlValue.forEach {<br>                it.convert(this, kType.arguments.single().type!!)<br>                myDataStructure.add(convertedElement)<br>            }<br>            myDataStructure<br>            } ?: pass()<br>    }<br>)<br>val result = TomlValue.from(Path.of(&quot;path&quot;, &quot;to&quot;, &quot;file.toml&quot;)).decode(myDecoder)</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><br>
<br><div class="symbol monospace"><span class="token keyword">inline </span><span class="token keyword">fun </span><span class="token operator">&lt;</span><span class="token keyword"></span><a href="with.html">T</a><span class="token operator"> : </span><a href="../../cc.ekblad.toml/-toml-value/index.html">TomlValue</a><span class="token punctuation">, </span><span class="token keyword"></span><a href="with.html">R</a><span class="token operator">&gt; </span><a href="with.html"><span class="token function">with</span></a><span class="token punctuation">(</span><span class="token keyword">crossinline </span>decoderFunction<span class="token operator">: </span><span class="token keyword"></span><a href="index.html">TomlDecoder</a><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword"></span><a href="with.html">T</a><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><span class="token keyword"></span><a href="with.html">R</a><span class="token punctuation">)</span><span class="token operator">: </span><a href="index.html">TomlDecoder</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Returns a copy of the receiver TOML decoder extended with a single custom decoder function, without having to manually specify its target type.</p><p class="paragraph">A decoder function registered this way may specify a more specific argument type than <a href="../../cc.ekblad.toml/-toml-value/index.html">TomlValue</a>. If it does, the function will only try to handle inputs of that specific type, automatically passing the input to the next decoder function in line if the input is of any other type.</p><p class="paragraph">If you care about the performance of this operation, the explicitly typed overload of this function is significantly faster when registering several decoder functions at the same time.</p><br><div class="symbol monospace"><span class="token keyword">inline </span><span class="token keyword">fun </span><span class="token operator">&lt;</span><span class="token keyword"></span><a href="with.html">T</a><span class="token operator"> : </span><a href="../../cc.ekblad.toml/-toml-value/index.html">TomlValue</a><span class="token punctuation">, </span><span class="token keyword"></span><a href="with.html">R</a><span class="token operator">&gt; </span><a href="with.html"><span class="token function">with</span></a><span class="token punctuation">(</span><span class="token keyword">crossinline </span>decoderFunction<span class="token operator">: </span><span class="token keyword"></span><a href="index.html">TomlDecoder</a><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword"></span>targetType<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-type/index.html">KType</a><span class="token punctuation">, </span><span class="token keyword"></span><a href="with.html">T</a><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><span class="token keyword"></span><a href="with.html">R</a><span class="token punctuation">)</span><span class="token operator">: </span><a href="index.html">TomlDecoder</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">Returns a copy of the receiver TOML decoder extended with a single custom decoder function, without having to manually specify its target type. The custom decoder function may make decoding decisions based on the <code class="lang-kotlin">KType</code> corresponding to the decoder target type.</p></div></div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2021 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  </body>
</html>

